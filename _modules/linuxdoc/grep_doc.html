
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>linuxdoc.grep_doc &#8212; LinuxDoc 20210110 documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/tabs.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <script>DOCUMENTATION_OPTIONS.URL_ROOT = '../../';</script>
   
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">LinuxDoc 20210110 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">linuxdoc.grep_doc</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for linuxdoc.grep_doc</h1><div class="highlight"><pre>
<span></span>#!/usr/bin/env python3
# -*- coding: utf-8; mode: python -*-
u&quot;&quot;&quot;
    grep_doc
    ~~~~~~~~

    Implementation of the ``kernel-grepdoc`` command.

    :copyright:  Copyright (C) 2018 Markus Heiser
    :license:    GPL Version 2, June 1991 see Linux/COPYING for details.

    The ``kernel-grepdoc`` command *greps* informations from Linux kernel&#39;s
    (reST) documentation, see ``--help``::

        $ kernel-grepdoc --help
&quot;&quot;&quot;

# ------------------------------------------------------------------------------
# imports
# ------------------------------------------------------------------------------

import argparse
import re
import sys

from fspath import FSPath

DESCRIPTION = &quot;&quot;&quot; The &#39;kernel-grepdoc&#39; command scans ``*.rst`` files from kernel&#39;s
``./Documentation`` source tree and filters all &#39;kernel-doc&#39; directives.  The
source files which are used in those &#39;kernel-doc&#39; directives are printed out as
list.  This list can be used to identify which files from the source tree has
already been ported to reST markup and which not.  You will need those sort of
list to distinguish between source files in *reST* and those in *vintage*
kernel-doc mode.&quot;&quot;&quot;

# ------------------------------------------------------------------------------
# config
# ------------------------------------------------------------------------------

PRINT  = lambda msg: sys.__stdout__.write(&quot;%s\n&quot; % msg)
ERR    = lambda msg: sys.__stderr__.write(&quot;ERROR: %s\n&quot; % msg)

KERNEL_DOC_RE = re.compile(r&#39;^\s*..\s+kernel-doc::\s+([a-zA-Z0-9_\-\.\/]+)&#39;)

# ------------------------------------------------------------------------------
<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.grep_doc.html#linuxdoc.grep_doc.main">[docs]</a>def main(): # pylint: disable=missing-docstring
# ------------------------------------------------------------------------------

    CLI = argparse.ArgumentParser(  # pylint: disable=invalid-name
        description = DESCRIPTION
        , formatter_class=argparse.ArgumentDefaultsHelpFormatter)

    CLI.add_argument(
        &quot;srctree&quot;
        , help    = &quot;Linux&#39;s source tree&quot;
        , type    = lambda x: FSPath(x).ABSPATH)

    CMD = CLI.parse_args()  # pylint: disable=invalid-name

    if not CMD.srctree.EXISTS:
        ERR(&quot;%s does not exists.&quot; % CMD.srctree)
        sys.exit(42)

    if not CMD.srctree.ISDIR:
        ERR(&quot;%s is not a folder.&quot; % CMD.srctree)
        sys.exit(42)

    rst_sources = set()
    doc_tree = CMD.srctree/&quot;Documentation&quot;
    for fname in doc_tree.reMatchFind(r&quot;^.*\.rst$&quot;):
        if fname.BASENAME == &#39;kernel-documentation.rst&#39;:
            continue
        #MSG(&quot;scan %s&quot; % fname)
        for line in fname.openTextFile():
            _m = KERNEL_DOC_RE.search(line)
            if _m:
                rst_sources.add(_m.group(1))

    rst_sources = list(rst_sources)
    rst_sources.sort()
    PRINT(&quot;\n&quot;.join(rst_sources))</div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
  <span id="sidebar-top"></span>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  
    
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/darmarIT_logo_128.png" alt="Logo"/>
            </a></p>
  

  <h3>Project Links</h3>
  <ul>
    <li><a href="https://return42.github.io/linuxdoc">Home</a>
  
    <li><a href="https://github.com/return42/linuxdoc">Source</a>
  
    <li><a href="https://return42.github.io/linuxdoc/linuxdoc-api/linuxdoc.html">API</a>
  
    <li><a href="https://github.com/return42/linuxdoc">Source</a>
  
    <li><a href="https://github.com/return42/linuxdoc/issues">Issue Tracker</a>
  
    <li><a href="mailto:markus.heiser@darmarIT.de">Contact</a>
  </ul><h3>Navigation</h3>
<ul>
  <li><a href="../../index.html">Overview</a>
    <ul>
      <li><a href="../index.html">Module code</a>
        
          
          </ul>
      </li>
    </ul>
  </li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021 Markus Heiser.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.3.
    </div>
  <script src="../../_static/version_warning_offset.js"></script>

  </body>
</html>